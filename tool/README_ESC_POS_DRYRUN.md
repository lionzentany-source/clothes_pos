# ESC/POS Dry-run (tool)

This document explains how to run the ESC/POS dry-run that generates thermal printer bytes from sample sale rows.

Purpose

- Provide a quick way to generate and inspect ESC/POS bytes in a Flutter context (so asset loading and `esc_pos_utils_plus` CapabilityProfile work correctly).

What was added

- `test/escpos_dryrun_test.dart`: a Flutter test that fabricates sample item rows, calls `EscposGenerator80.buildReceiptFromRows`, prints the generated bytes as hex, and asserts the result is not empty.

How to run (PowerShell)

1. From the repository root run the single test file (this runs inside Flutter and guarantees the right SDK context):

```powershell
flutter test test/escpos_dryrun_test.dart -r expanded
```

2. To save the printed hex output to a file:

```powershell
flutter test test/escpos_dryrun_test.dart -r expanded > tool/outputs/escpos_dryrun_latest.txt
```

Notes

- The test prints a header with the generated byte count and then a hex dump of the ESC/POS bytes. Redirecting the test output captures that dump.
- Running the test requires the Flutter SDK to be installed and on PATH. The project already depends on `esc_pos_utils_plus` and the test uses `EscposGenerator80.create()` which loads the capability profile from package assets.

Suggested next steps

- If you want CI to validate the receipt layout, convert the test into a `flutter_test` that asserts presence of key substrings (e.g., attribute text) in the decoded bytes.
- If you maintain multiple printer profiles, create additional tests with `PaperSize.mm58` or other profiles.
