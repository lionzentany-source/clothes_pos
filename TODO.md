# Clothes POS - قائمة المهام

هذه الوثيقة تتبع المهام المطلوبة لتحسين استقرار وميزات تطبيق Clothes POS.

## 1. تكامل RFID ومتانته (أولوية قصوى)

- [x] **اختبار شامل:** إجراء اختبارات مكثفة لتكامل RFID، بما في ذلك سيناريوهات الأخطاء (مثل عدم اتصال القارئ، قراءة خاطئة). **(محظور: مشكلة تهيئة قاعدة البيانات في بيئة الاختبار تمنع تشغيل الاختبارات.)**
- [ ] **معالجة الأخطاء:** التأكد من أن التطبيق يتعامل مع أخطاء قارئ RFID بسلاسة، ويوفر رسائل واضحة للمستخدم، ويستعيد حالته بشكل صحيح.
- [ ] **الأداء:** اختبار أداء قراءة RFID بكميات كبيرة من المنتجات.

## 2. الطباعة الحرارية

- [x] **توليد الإيصالات الفعلية:** استبدال تذكرة الاختبار الحالية بمنطق يولد إيصالات حقيقية بناءً على بيانات البيع الفعلية باستخدام `EscposGenerator80`.
- [ ] **متانة الاتصال:** اختبار الطباعة على شبكات مختلفة ومعالجة أخطاء الاتصال بالطابعة.
- [ ] **واجهة إعدادات الطابعة:** توفير واجهة مستخدم واضحة لإعدادات الطابعة الحرارية (IP، المنفذ).

## 3. الأداء وقابلية التوسع

- [ ] **تحسين استعلامات قاعدة البيانات:** تحليل وتحسين الاستعلامات البطيئة (مثل إضافة فهارس).
- [ ] **أداء واجهة المستخدم:** اختبار وتحسين أداء الشاشات التي تعرض كميات كبيرة من البيانات.
- [ ] **التحميل الكسول/التقسيم:** تطبيق التحميل الكسول (Lazy Loading) أو التقسيم (Pagination) للقوائم الطويلة.

## 4. معالجة الأخطاء الشاملة

- [ ] **استراتيجية موحدة:** تطوير استراتيجية موحدة لمعالجة الأخطاء في جميع أنحاء التطبيق.
- [ ] **رسائل خطأ واضحة:** التأكد من أن جميع رسائل الخطأ الموجهة للمستخدم واضحة ومفيدة.
- [ ] **دمج خدمة الإبلاغ عن الأعطال:** دمج خدمة مثل Firebase Crashlytics أو Sentry.

## 5. النشر والتحديثات

- [ ] **خطوط أنابيب CI/CD:** إنشاء خطوط أنابيب CI/CD لتبسيط عملية الإصدار.
- [ ] **آلية التحديث داخل التطبيق:** تطبيق آلية تحديث لتطبيقات سطح المكتب.

## 6. قابلية المراقبة (Observability)

- [ ] **تسجيل منظم:** تحسين نظام التسجيل ليكون أكثر تنظيمًا مع مستويات مختلفة.
- [ ] **التحليلات (Analytics):** دمج أداة تحليلات لتتبع سلوك المستخدم إذا لزم الأمر.

## 7. الترجمة ودعم RTL

- [ ] **اختبار RTL:** اختبار واجهة المستخدم بشكل مكثف في وضع RTL.
- [ ] **تغطية الترجمة:** التأكد من ترجمة جميع السلاسل النصية في التطبيق.

## 8. اختبارات الوحدة والتكامل

- [ ] **توسيع تغطية الاختبار:** زيادة تغطية اختبارات الوحدة لمنطق العمل (BLoCs, Repositories) واختبارات الودجت.
- [ ] **إضافة اختبارات الأداء:** إضافة اختبارات أداء للوظائف الحرجة.

## 9. إدارة الصلاحيات

- [ ] **صلاحيات دقيقة:** التأكد من أن الإجراءات الحساسة يتم التحكم فيها بواسطة صلاحيات دقيقة بناءً على دور المستخدم.

---

ملاحظة (تحديث):

تم تنفيذ جزء من عمل "الخصائص الديناميكية" ودمج العرض والطباعـة في المسارات التالية:

- `lib/presentation/common/widgets/variant_attributes_display.dart` — ودجت عرض خصائص المتغير.
- `lib/core/printing/receipt_pdf_service.dart` — طباعة خصائص المنتج في إيصالات PDF.
- `lib/core/printing/escpos_generator.dart` — إضافة `buildReceiptFromRows` لتضمين الخصائص في الإيصالات الحرارية.
- `lib/presentation/pos/screens/pos_screen.dart` — إثراء صفوف البيع بالخصائص قبل توليد الطباعة الحرارية.
- `lib/presentation/purchases/screens/purchase_history_screen.dart` و
  `lib/presentation/purchases/screens/purchase_list_screen.dart` — تحميل وعرض خصائص عناصر الفاتورة.

نتيجة فحص المُصدِّرات:

- تم البحث في `lib/`, `tool/`, و`server/` عن مُصدِّرات CSV/XLS التي تتضمن خطوط منتجات؛ لم يتم العثور على مُصدِّر خطوط منتجات ضمن `lib/` باستثناء مُصدِّر المصروفات (`expense_list_screen.dart`) الذي لا يتطلب إثراءً بالخصائص.
- بعض سكربتات المساعدة في `tool/` تنتج CSVs (مثل تقارير الاكتشاف والالتزامات المخططة) لكنها خاصة بعمليات ترحيل/تحليل البيانات ولا تُصدر فواتير/قوائم منتجات مباشرة.

التوصية التالية: تشغيل اختبار عملي لطباعة حرارية مع طابعة شبكة أو تشغيل مولد ESC/POS على بيانات عيّنة للتأكد من تخطيط السطر والاحتواء الصحيح للخصائص.
